#!/bin/bash

. "/usr/share/i3blocks/status/lib/status.bash"

args=(${BLOCK_INSTANCE})
icon=${args[0]}
interface=${args[1]}
signal_command=${args[2]}

if [ ${BLOCK_BUTTON} == 3 ]; then
  set_timer
fi

value=0
if grep "^${interface}" /proc/net/route > /dev/null; then
  value=100
  if [ -n "${signal_command}" ]; then
    raw_value=$(${signal_command})
    value=$(scale ${raw_value} 0 31)
    info_string=" ${value}%"
  fi

  if get_timer 5; then
    info_string=" "$(ip addr show ${interface} | \
      grep "    inet " | cut -f 6 -d " ")
  fi
fi

format_info "" ${value} "${icon}${info_string}" true
